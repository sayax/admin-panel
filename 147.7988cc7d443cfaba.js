"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[147],{7147:($,f,a)=>{a.r(f),a.d(f,{EventModule:()=>d});var m=a(4666),t=a(2560),b=a(6413),l=a(2508),i=a(1008),Z=a(4633),E=a(3432),y=a(4164),x=a(2673),A=a(3223);class c{constructor(){this.eventApiService=(0,t.f3M)(A.p),this.nbAuthService=(0,t.f3M)(y._o)}getEvents(){return this.eventApiService.getEvents()}addEvent(n){return this.nbAuthService.getToken().pipe((0,x.w)(e=>(n.owner_uid=e.getPayload().user_id,this.eventApiService.addEvent(n))))}updateEvent(n){return this.eventApiService.updateEvent(n)}removeEvent(n){return this.eventApiService.removeEvent(n)}}c.\u0275fac=function(n){return new(n||c)},c.\u0275prov=t.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"});const C={1:"\u041f\u043e\u043d\u0435\u0434\u0435\u043b\u044c\u043d\u0438\u043a",2:"\u0412\u0442\u043e\u0440\u043d\u0438\u043a",3:"\u0421\u0440\u0435\u0434\u0430",4:"\u0427\u0435\u0442\u0432\u0435\u0440\u0433",5:"\u041f\u044f\u0442\u043d\u0438\u0446\u0430",6:"\u0421\u0443\u0431\u0431\u043e\u0442\u0430",0:"\u0412\u043e\u0441\u043a\u0440\u0435\u0441\u0435\u043d\u044c\u0435"};var h=a(7091),T=a(7941);function M(u,n){if(1&u&&(t.TgZ(0,"div",3),t._uU(1),t.qZA()),2&u){const e=n.ngIf;t.xp6(1),t.AsE("",e.first_name," ",e.last_name,"")}}function q(u,n){if(1&u&&(t.TgZ(0,"div",3),t._uU(1),t.ALo(2,"date"),t.qZA()),2&u){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,e.created_on.toMillis(),"dd MM yyyy HH:mm"))}}function D(u,n){if(1&u&&(t.TgZ(0,"div",3),t._uU(1),t.ALo(2,"date"),t.qZA()),2&u){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,e.updated_on.toMillis(),"dd MM yyyy HH:mm"))}}function U(u,n){if(1&u&&(t.TgZ(0,"div",3),t._uU(1),t.ALo(2,"date"),t.qZA()),2&u){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,e.start_date.toMillis(),"dd MM yyyy HH:mm"))}}function O(u,n){if(1&u&&(t.TgZ(0,"div",3),t._uU(1),t.ALo(2,"date"),t.qZA()),2&u){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,e.end_date.toMillis(),"dd MM yyyy HH:mm"))}}const L=function(u){return["../",u]};function N(u,n){if(1&u){const e=t.EpF();t.TgZ(0,"nb-list-item",2)(1,"div",3),t._uU(2),t.qZA(),t.TgZ(3,"div",3),t._uU(4),t.qZA(),t.TgZ(5,"div",3),t._uU(6),t.qZA(),t.YNc(7,M,2,2,"div",7),t.ALo(8,"async"),t.ALo(9,"user"),t.YNc(10,q,3,4,"div",7),t.YNc(11,D,3,4,"div",7),t.YNc(12,U,3,4,"div",7),t.YNc(13,O,3,4,"div",7),t.TgZ(14,"div",3)(15,"button",8),t._UZ(16,"nb-icon",9),t.qZA(),t.TgZ(17,"button",10),t.NdJ("click",function(){const r=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.deleteEvent(r))}),t._UZ(18,"nb-icon",11),t.qZA()()()}if(2&u){const e=n.$implicit;t.oxw();const s=t.MAs(29);t.xp6(2),t.Oqu(e.uid),t.xp6(2),t.Oqu(e.title),t.xp6(2),t.Oqu(e.is_active?"\u0410\u043a\u0442\u0438\u0432\u0435\u043d":"\u0414\u0435\u0430\u043a\u0442\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u043d"),t.xp6(1),t.Q6J("ngIf",t.lcZ(8,14,t.lcZ(9,16,e.owner_uid)))("ngIfElse",s),t.xp6(3),t.Q6J("ngIf",e.created_on)("ngIfElse",s),t.xp6(1),t.Q6J("ngIf",e.updated_on)("ngIfElse",s),t.xp6(1),t.Q6J("ngIf",e.start_date)("ngIfElse",s),t.xp6(1),t.Q6J("ngIf",e.end_date)("ngIfElse",s),t.xp6(2),t.Q6J("routerLink",t.VKq(18,L,e.uid))}}function I(u,n){1&u&&t._UZ(0,"div",3)}function J(u,n){if(1&u&&(t.TgZ(0,"nb-option",32),t._uU(1),t.qZA()),2&u){const e=n.$implicit;t.Q6J("value",e.uid),t.xp6(1),t.AsE("",e.first_name," ",e.last_name,"")}}function k(u,n){if(1&u&&(t.TgZ(0,"nb-option",32),t._uU(1),t.qZA()),2&u){const e=n.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function B(u,n){if(1&u&&(t.ynx(0),t._UZ(1,"input",33)(2,"nb-date-timepicker",34,35),t.BQk()),2&u){const e=t.MAs(3);t.xp6(1),t.Q6J("nbDatepicker",e),t.xp6(1),t.Q6J("step",30)}}function F(u,n){1&u&&t._UZ(0,"input",36)}function Q(u,n){if(1&u&&(t.ynx(0),t._UZ(1,"input",37)(2,"nb-date-timepicker",34,38),t.BQk()),2&u){const e=t.MAs(3);t.xp6(1),t.Q6J("nbDatepicker",e),t.xp6(1),t.Q6J("step",30)}}function w(u,n){1&u&&t._UZ(0,"input",39)}function H(u,n){if(1&u&&(t.TgZ(0,"nb-option",32),t._uU(1),t.qZA()),2&u){const e=n.$implicit;t.Q6J("value",e.value),t.xp6(1),t.Oqu(e.title)}}function S(u,n){if(1&u){const e=t.EpF();t.TgZ(0,"nb-card")(1,"nb-card-header"),t._uU(2,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435"),t.qZA(),t.TgZ(3,"nb-card-body")(4,"form",12)(5,"div",13)(6,"label",14),t._uU(7,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"),t.qZA(),t._UZ(8,"input",15),t.qZA(),t.TgZ(9,"div",13)(10,"label",16),t._uU(11,"\u041f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u0438"),t.qZA(),t.TgZ(12,"nb-select",17),t.YNc(13,J,2,3,"nb-option",18),t.ALo(14,"async"),t.qZA()(),t.TgZ(15,"div",13)(16,"label",19),t._uU(17,"\u0426\u0432\u0435\u0442"),t.qZA(),t.TgZ(18,"nb-select",20),t.YNc(19,k,2,2,"nb-option",18),t.qZA()(),t.TgZ(20,"div",13)(21,"label",21),t._uU(22,"\u041d\u0430\u0447\u0430\u043b\u043e"),t.qZA(),t.YNc(23,B,4,2,"ng-container",22),t.YNc(24,F,1,0,"ng-template",null,23,t.W1O),t.qZA(),t.TgZ(26,"div",13)(27,"label",24),t._uU(28,"\u041e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u0435"),t.qZA(),t.YNc(29,Q,4,2,"ng-container",22),t.YNc(30,w,1,0,"ng-template",null,25,t.W1O),t.qZA(),t.TgZ(32,"div",13)(33,"label",26),t._uU(34,"\u0414\u043d\u0438"),t.qZA(),t.TgZ(35,"nb-select",27),t.YNc(36,H,2,2,"nb-option",18),t.qZA()(),t.TgZ(37,"nb-checkbox",28),t._uU(38,"\u0412\u0435\u0441\u044c \u0434\u0435\u043d\u044c"),t.qZA()()(),t.TgZ(39,"nb-card-footer",29)(40,"button",30),t.NdJ("click",function(){const r=t.CHM(e).dialogRef;return t.KtG(r.close())}),t._uU(41,"\u041e\u0442\u043c\u0435\u043d\u0430"),t.qZA(),t.TgZ(42,"button",31),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.addEvent(o.form))}),t._uU(43,"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),t.qZA()()()}if(2&u){const e=t.MAs(25),s=t.MAs(31),o=t.oxw();let r,p,g;t.xp6(4),t.Q6J("formGroup",o.form),t.xp6(8),t.Q6J("status",null!=(r=o.form.get("teacher_uids"))&&r.touched?null!=(r=o.form.get("teacher_uids"))&&r.invalid?"danger":"success":"basic"),t.xp6(1),t.Q6J("ngForOf",t.lcZ(14,12,o.users$)),t.xp6(5),t.Q6J("status",null!=(p=o.form.get("colors"))&&p.touched?null!=(p=o.form.get("colors"))&&p.invalid?"danger":"success":"basic"),t.xp6(1),t.Q6J("ngForOf",o.colorOptions),t.xp6(4),t.Q6J("ngIf",!o.isMobile)("ngIfElse",e),t.xp6(6),t.Q6J("ngIf",!o.isMobile)("ngIfElse",s),t.xp6(6),t.Q6J("status",null!=(g=o.form.get("days"))&&g.touched?null!=(g=o.form.get("days"))&&g.invalid?"danger":"success":"basic"),t.xp6(1),t.Q6J("ngForOf",o.dayOptions),t.xp6(6),t.Q6J("disabled",o.loading)}}class _{constructor(){this.formBuilder=(0,t.f3M)(l.qu),this.dialogService=(0,t.f3M)(i.Gln),this.teacherService=(0,t.f3M)(E.S),this.eventService=(0,t.f3M)(c),this.toastr=(0,t.f3M)(i.quB),this.users$=this.teacherService.getList(),this.form=this.formBuilder.group({uid:[""],allDay:[!1],colors:["",l.kI.required],start_date:["",l.kI.required],end_date:["",l.kI.required],days:[[]],meta:this.formBuilder.group({type:["info"]}),title:["",l.kI.required],teacher_uids:[[],l.kI.required],is_active:[!0,l.kI.required]}),this.loading=!1,this.colorOptions=Object.keys(Z.O),this.dayOptions=Object.entries(C).map(([n,e])=>({value:n,title:e})),this.isMobile=!1}calculateRows(){this.isMobile=window.innerWidth<768}ngOnInit(){this.calculateRows(),this.getData()}getData(){this.events$=this.eventService.getEvents()}openDialog(n,e){this.ref=this.dialogService.open(n,{context:e})}addEvent(n){const e=new Date(n.value.start_date),s=new Date(n.value.end_date);isNaN(e.getTime())||isNaN(s.getTime())?this.toastr.show("\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u0434\u0430\u0442\u044b","\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430",{status:"danger"}):(n.value.start_date=b.EK.fromDate(e),n.value.end_date=b.EK.fromDate(s),n.value.days=n.value.days.map(o=>+o),this.eventService.addEvent(n.value).subscribe({complete:()=>{this.toastr.show("\u0421\u043e\u0431\u044b\u0442\u0438\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e","\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b",{status:"success"}),this.loading=!1,this.ref.close(),this.getData()},error:o=>{this.toastr.show(o?.message,"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430",{status:"danger"}),console.log("error",o),this.loading=!1}}))}deleteEvent(n){this.eventService.removeEvent({uid:n.uid}).subscribe(()=>{this.toastr.show("\u0421\u043e\u0431\u044b\u0442\u0438\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u043e","\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b",{status:"success"}),this.getData()})}}_.\u0275fac=function(n){return new(n||_)},_.\u0275cmp=t.Xpm({type:_,selectors:[["app-event-list"]],hostBindings:function(n,e){1&n&&t.NdJ("resize",function(o){return e.calculateRows(o)},!1,t.Jf7)},decls:32,vars:3,consts:[["nbButton","","status","primary","type","button",3,"click"],[1,"event-table"],[1,"event-row"],[1,"event-cell"],["class","event-row",4,"ngFor","ngForOf"],["empty",""],["createDialog",""],["class","event-cell",4,"ngIf","ngIfElse"],["type","button","nbButton","",3,"routerLink"],["icon","edit-outline"],["type","button","nbButton","",3,"click"],["icon","trash-outline"],[3,"formGroup"],[1,"form-group"],["for","title"],["name","title","nbInput","","formControlName","title"],["for","teacher_uids"],["multiple","","placeholder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u0435\u0439","name","teacher_uids","formControlName","teacher_uids",3,"status"],[3,"value",4,"ngFor","ngForOf"],["for","colors"],["placeholder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0446\u0432\u0435\u0442","name","colors","formControlName","colors",3,"status"],["for","start_date"],[4,"ngIf","ngIfElse"],["startDate",""],["for","end_date"],["endDate",""],["for","days"],["multiple","","placeholder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u043d\u0438","name","days","formControlName","days",3,"status"],["formControlName","allDay"],[1,"footer"],["nbButton","",3,"click"],["nbButton","","status","primary",3,"disabled","click"],[3,"value"],["name","start_date","nbInput","","placeholder","yyyy-mm-dd HH:mm","formControlName","start_date",3,"nbDatepicker"],["singleColumn","",3,"step"],["startDatePicker",""],["name","start_date","nbInput","","placeholder","yyyy-mm-dd HH:mm","formControlName","start_date"],["name","end_date","nbInput","","placeholder","yyyy-mm-dd HH:mm","formControlName","end_date",3,"nbDatepicker"],["endDatePicker",""],["name","end_date","nbInput","","placeholder","yyyy-mm-dd HH:mm","formControlName","end_date"]],template:function(n,e){if(1&n){const s=t.EpF();t.TgZ(0,"nb-layout")(1,"nb-layout-column")(2,"nb-card")(3,"nb-card-header")(4,"button",0),t.NdJ("click",function(){t.CHM(s);const r=t.MAs(31);return t.KtG(e.openDialog(r))}),t._uU(5,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"),t.qZA()(),t.TgZ(6,"nb-card-body")(7,"nb-list",1)(8,"nb-list-item",2)(9,"div",3),t._uU(10,"UID"),t.qZA(),t.TgZ(11,"div",3),t._uU(12,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"),t.qZA(),t.TgZ(13,"div",3),t._uU(14,"\u0421\u0442\u0430\u0442\u0443\u0441"),t.qZA(),t.TgZ(15,"div",3),t._uU(16,"\u041a\u0442\u043e"),t.qZA(),t.TgZ(17,"div",3),t._uU(18,"\u0414\u0430\u0442\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f"),t.qZA(),t.TgZ(19,"div",3),t._uU(20,"\u0414\u0430\u0442\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f"),t.qZA(),t.TgZ(21,"div",3),t._uU(22,"\u041d\u0430\u0447\u0430\u043b\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u044f"),t.qZA(),t.TgZ(23,"div",3),t._uU(24,"\u041e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"),t.qZA(),t._UZ(25,"div",3),t.qZA(),t.YNc(26,N,19,20,"nb-list-item",4),t.ALo(27,"async"),t.YNc(28,I,1,0,"ng-template",null,5,t.W1O),t.qZA()()()()(),t.YNc(30,S,44,14,"ng-template",null,6,t.W1O)}2&n&&(t.xp6(26),t.Q6J("ngForOf",t.lcZ(27,1,e.events$)))},dependencies:[m.sg,m.O5,i.Aqw,i.dP_,i.Asz,i.yKW,i.XWE,i.ndF,i.fMN,i.h8i,i.DPz,i.rs,i.q51,i.zP_,i.qBV,i.NTf,i.$kf,i.VW_,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,h.rH,m.Ov,m.uU,T.d],styles:["[_nghost-%COMP%]{--button-filled-basic-background-color: transparent;--button-filled-basic-hover-background-color: transparent;--button-filled-basic-focus-background-color: transparent}.form-group[_ngcontent-%COMP%]{margin-bottom:.625rem}nb-base-calendar[_ngcontent-%COMP%]   nb-card-body[_ngcontent-%COMP%]{flex-direction:column}@media screen and (max-width: 768px){nb-date-timepicker[_ngcontent-%COMP%]{display:none}}.event-row[_ngcontent-%COMP%]{column-gap:6px;align-items:center}.event-cell[_ngcontent-%COMP%]{width:calc(12.5% - 5px);text-overflow:ellipsis;overflow-x:hidden}.event-cell[_ngcontent-%COMP%]:last-child{flex-shrink:0;width:40px}.event-cell[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:4px}"]});var Y=a(4466);class v{}v.\u0275fac=function(n){return new(n||v)},v.\u0275cmp=t.Xpm({type:v,selectors:[["app-event-edit"]],decls:2,vars:0,template:function(n,e){1&n&&(t.TgZ(0,"p"),t._uU(1,"event-edit works!"),t.qZA())}});const P=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:_,data:{title:"\u0421\u043e\u0431\u044b\u0442\u0438\u044f"}},{path:":id",component:v,data:{title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435"}}];class d{}d.\u0275fac=function(n){return new(n||d)},d.\u0275mod=t.oAB({type:d}),d.\u0275inj=t.cJS({imports:[m.ez,i.BW0,i.zyh,i.KdK,i.nKr,i.T2N,i.IIj,i.COg,i.MfT,i.OA,i.kmq,l.UX,Y.m,h.Bz.forChild(P)]})}}]);
//# sourceMappingURL=147.7988cc7d443cfaba.js.map