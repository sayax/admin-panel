"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[592],{3223:(U,f,s)=>{s.d(f,{p:()=>p});var l=s(2560),t=s(8873),u=s(6413),o=s(9345),d=s(3609),_=s(2673),m=s(635),T=s(1640),E=s(5474);class p{constructor(){this.firestore=(0,l.f3M)(t.gg),this.eventsCollection=(0,t.hJ)(this.firestore,o.F.EVENTS)}getFilteredEvents(){const e=(0,t.IO)(this.eventsCollection,(0,t.ar)("is_active","==",!0),(0,t.Xo)("start_date"));return(0,d.D)((0,t.PL)(e)).pipe((0,_.w)(r=>{const n=r.docs.map(i=>i.data()).map(i=>{const v=(0,t.hJ)(this.firestore,o.F.EVENTS,i.uid,o.F.EVENT_SCHEDULES),h=(0,t.IO)(v);return(0,d.D)((0,t.PL)(h)).pipe((0,m.U)(c=>c.docs.map(D=>D.data()).map(D=>({...i,start_date:D.start_date,end_date:D.end_date,is_active:D.is_active}))))});return(0,T.D)(n).pipe((0,m.U)(i=>i.flat()))}))}getEvents(){const e=(0,t.IO)(this.eventsCollection,(0,t.Xo)("created_on","desc"));return(0,d.D)((0,t.PL)(e)).pipe((0,m.U)(r=>r.docs.map(a=>a.data())))}addEvent(e){return e?this.hasParameter(e,"start_date")&&this.hasParameter(e,"end_date")&&this.hasParameter(e,"days")?(e.created_on=u.EK.now(),e.updated_on=u.EK.now(),e.is_active=!0,(0,d.D)((0,t.ET)(this.eventsCollection,e)).pipe((0,_.w)(r=>{const a=[e.start_date.toDate().getHours(),e.start_date.toDate().getMinutes()],n=[e.end_date.toDate().getHours(),e.end_date.toDate().getMinutes()],i=this.getDateList(e.start_date,e.end_date,e.days).map(v=>({is_active:!0,start_date:u.EK.fromMillis(v.setHours(a[0],a[1])),end_date:u.EK.fromMillis(v.setHours(n[0],n[1]))}));return(0,T.D)([this.addSchedules(r.id,i),this.updateEvent({uid:r.id})]).pipe((0,m.U)(()=>r.id))}))):(0,E._)(()=>new Error("Parameter is missing")):(0,E._)(()=>new Error("Event is missing"))}addSchedules(e,r){const a=(0,t.qs)(this.firestore),n=(0,t.hJ)(this.firestore,o.F.EVENTS,e,o.F.EVENT_SCHEDULES);return r.map(i=>{a.set((0,t.JU)(n),i)}),(0,d.D)(a.commit())}updateEvent(e){if(!e.uid)return(0,E._)(()=>new Error("ID is missing"));const r=(0,t.JU)(this.eventsCollection,e.uid);return(0,d.D)((0,t.QT)(r)).pipe((0,_.w)(a=>(e.updated_on=u.EK.now(),a.exists()?(0,d.D)((0,t.r7)(r,e)):(e.created_on=u.EK.now(),(0,d.D)((0,t.pl)(r,e))))))}removeEvent(e){const r=(0,t.JU)(this.eventsCollection,e.uid);return e.updated_on=u.EK.now(),(0,d.D)((0,t.r7)(r,{is_active:!1,updated_on:e.updated_on}))}getDateList(e,r,a){if(!e||!r)return[];const n=[];let i=e.toDate();for(;i.getTime()<=r.toMillis();)a.includes(i.getDay())&&n.push(new Date(i)),i.setDate(i.getDate()+1);return n}hasParameter(e,r){return null!==e[r]||void 0!==e[r]}}p.\u0275fac=function(e){return new(e||p)},p.\u0275prov=l.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"})},4633:(U,f,s)=>{s.d(f,{O:()=>l});const l={red:{primary:"#ad2121",secondary:"#FAE3E3"},blue:{primary:"#1e90ff",secondary:"#D1E8FF"},yellow:{primary:"#e3bc08",secondary:"#FDF1BA"}}},7941:(U,f,s)=>{s.d(f,{d:()=>o});var l=s(2560),t=s(745),u=s(9785);class o{constructor(){this.userApiService=(0,l.f3M)(u.Q)}transform(_){return _?(console.log(_),this.userApiService.getUser(_)):(0,t.of)(null)}}o.\u0275fac=function(_){return new(_||o)},o.\u0275pipe=l.Yjl({name:"user",type:o,pure:!0})},3432:(U,f,s)=>{s.d(f,{S:()=>p});var l=s(2560),t=s(8873),u=s(6413),o=s(3609),d=s(2673),_=s(635),m=s(9345),T=s(9785);class E{constructor(){this.firestore=(0,l.f3M)(t.gg),this.teacherCollection=(0,t.hJ)(this.firestore,m.F.TEACHER),this.userApiService=(0,l.f3M)(T.Q)}getTeachers(){const e=(0,t.IO)(this.teacherCollection,(0,t.ar)("is_active","==",!0));return(0,o.D)((0,t.PL)(e)).pipe((0,d.w)(a=>{const n=a.docs.map(h=>h.data()),i=n.reduce((h,c)=>({...h,[c.uid]:c}),{}),v=n.map(h=>h.uid);return this.userApiService.getUsersInList(v).pipe((0,_.U)(h=>h.map(c=>({uid:i[c.uid].uid,phone:c.phone,email:c.email,first_name:c.first_name,middle_name:c.middle_name,last_name:c.last_name,avatar_url:c.avatar_urls?c.avatar_urls[0]:"",start_date:i[c.uid].start_date,styles:i[c.uid].styles,level:i[c.uid].level}))))}))}getTeacher(e){const r=(0,t.JU)(this.teacherCollection,e);return(0,o.D)((0,t.QT)(r)).pipe((0,_.U)(a=>a.data()),(0,d.w)(a=>this.userApiService.getUser(a.uid).pipe((0,_.U)(n=>({uid:a.uid,phone:n.phone,email:n.email,first_name:n.first_name,middle_name:n.middle_name,last_name:n.last_name,avatar_url:n.avatar_urls[0],start_date:a.start_date,styles:a.styles,level:a.level})))))}addTeacher(e){const r=(0,t.JU)(this.teacherCollection,e.uid);return(0,o.D)((0,t.QT)(r)).pipe((0,d.w)(a=>(e.updated_on=u.EK.now(),e.start_date=u.EK.now(),a.exists()?(0,o.D)((0,t.r7)(r,e)):(e.created_on=u.EK.now(),(0,o.D)((0,t.pl)(r,e))))),(0,d.w)(()=>this.userApiService.updateUser({uid:e.uid,is_teacher:!0})))}removeTeacher(e){const r=(0,t.JU)(this.teacherCollection,e.uid);return e.updated_on=u.EK.now(),e.end_date=u.EK.now(),(0,o.D)((0,t.r7)(r,{uid:e.uid,is_active:!1,updated_on:e.updated_on,end_date:e.end_date})).pipe((0,d.w)(()=>this.userApiService.updateUser({uid:e.uid,is_teacher:!1})))}}E.\u0275fac=function(e){return new(e||E)},E.\u0275prov=l.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"});class p{constructor(){this.teacherApiService=(0,l.f3M)(E),this.userApiService=(0,l.f3M)(T.Q)}getList(){return this.teacherApiService.getTeachers()}getUsers(){return this.userApiService.getUsersNotTeachers()}addTeacher(e){return this.teacherApiService.addTeacher(e)}removeTeacher(e){return this.teacherApiService.removeTeacher(e)}}p.\u0275fac=function(e){return new(e||p)},p.\u0275prov=l.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"})}}]);
//# sourceMappingURL=common.b4cd5ed1b22b0ffa.js.map