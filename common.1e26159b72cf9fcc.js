"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[592],{3223:(M,m,n)=>{n.d(m,{p:()=>i});var E=n(2560),e=n(8873),l=n(6413),c=n(9345),o=n(3609),_=n(2673),f=n(635),v=n(1640),p=n(5474),D=n(9525),T=n(745);class i{constructor(){this.firestore=(0,E.f3M)(e.gg),this.eventsCollection=(0,e.hJ)(this.firestore,c.F.EVENTS)}getFilteredEvents(){const t=(0,e.IO)(this.eventsCollection,(0,e.ar)("is_active","==",!0),(0,e.Xo)("start_date"));return(0,o.D)((0,e.PL)(t)).pipe((0,_.w)(r=>{const d=r.docs.map(s=>s.data()).map(s=>{const u=(0,e.hJ)(this.firestore,c.F.EVENTS,s.uid,c.F.EVENT_SCHEDULES),U=(0,e.IO)(u);return(0,o.D)((0,e.PL)(U)).pipe((0,f.U)(P=>P.docs.map(g=>g.data()).map(g=>({...s,start_date:g.start_date,end_date:g.end_date,is_active:g.is_active}))))});return(0,v.D)(d).pipe((0,f.U)(s=>s.flat()))}))}getEvents(){const t=(0,e.IO)(this.eventsCollection,(0,e.Xo)("created_on","desc"));return(0,o.D)((0,e.PL)(t)).pipe((0,f.U)(r=>r.docs.map(a=>a.data())))}addEvent(t){return t?this.hasParameter(t,"start_date")&&this.hasParameter(t,"end_date")&&this.hasParameter(t,"days")?(t.created_on=l.EK.now(),t.updated_on=l.EK.now(),t.is_active=!0,(0,o.D)((0,e.ET)(this.eventsCollection,t)).pipe((0,_.w)(r=>{const a=[t.start_date.toDate().getHours(),t.start_date.toDate().getMinutes()],d=[t.end_date.toDate().getHours(),t.end_date.toDate().getMinutes()],s=this.getDateList(t.start_date,t.end_date,t.days).map(u=>({is_active:!0,start_date:l.EK.fromMillis(u.setHours(a[0],a[1])),end_date:l.EK.fromMillis(u.setHours(d[0],d[1]))}));return(0,v.D)([this.addSchedules(r.id,s),this.updateEvent({uid:r.id})]).pipe((0,f.U)(()=>r.id))}))):(0,p._)(()=>new Error("Parameter is missing")):(0,p._)(()=>new Error("Event is missing"))}addSchedules(t,r){const a=(0,e.qs)(this.firestore),d=(0,e.hJ)(this.firestore,c.F.EVENTS,t,c.F.EVENT_SCHEDULES);return r.map(s=>{a.set((0,e.JU)(d),s)}),(0,o.D)(a.commit())}updateEvent(t){if(!t.uid)return(0,p._)(()=>new Error("ID is missing"));const r=(0,e.JU)(this.eventsCollection,t.uid);return(0,o.D)((0,e.QT)(r)).pipe((0,_.w)(a=>(t.updated_on=l.EK.now(),a.exists()?(0,o.D)((0,e.r7)(r,t)):(t.created_on=l.EK.now(),(0,o.D)((0,e.pl)(r,t))))))}updateEnrolledParticipants(t){if(!t.uid)return(0,p._)(()=>new Error("ID is missing"));const r=(0,e.JU)(this.eventsCollection,t.uid);return(0,o.D)((0,e.QT)(r)).pipe((0,_.w)(a=>{const d=l.EK.now();if(a.exists())return(0,o.D)((0,e.r7)(r,{enrolled_participants:(0,e.vr)(t.enrolled_participants),updated_on:d}));const s=l.EK.now();return(0,o.D)((0,e.pl)(r,{enrolled_participants:(0,e.vr)(t.enrolled_participants),updated_on:d,created_on:s}))}))}removeEnrolledParticipants(t){if(!t.uid)return(0,p._)(()=>new Error("ID is missing"));const r=(0,e.JU)(this.eventsCollection,t.uid);return(0,o.D)((0,e.QT)(r)).pipe((0,_.w)(a=>{const d=l.EK.now();if(a.exists())return(0,o.D)((0,e.r7)(r,{enrolled_participants:(0,e.Ab)(t.enrolled_participants),updated_on:d}));const s=l.EK.now();return(0,o.D)((0,e.pl)(r,{enrolled_participants:(0,e.Ab)(t.enrolled_participants),updated_on:d,created_on:s}))}))}removeEvent(t){const r=(0,e.JU)(this.eventsCollection,t.uid);return t.updated_on=l.EK.now(),(0,o.D)((0,e.r7)(r,{is_active:!1,updated_on:t.updated_on}))}getEvent(t){const r=(0,e.JU)(this.eventsCollection,t);return(0,o.D)((0,e.QT)(r)).pipe((0,D.z)(a=>a.exists()?(0,T.of)(a):(0,p._)(()=>new Error("Event not found"))),(0,f.U)(a=>a.data()))}getEventSchedules(t){const r=(0,e.hJ)(this.firestore,c.F.EVENTS,t,c.F.EVENT_SCHEDULES),a=(0,e.IO)(r,(0,e.Xo)("start_date"));return(0,o.D)((0,e.PL)(a)).pipe((0,f.U)(d=>d.docs.map(s=>({...s.data(),uid:s.id}))))}updateEventSchedule(t,r){if(!t||!r.uid)return(0,p._)(()=>new Error("ID is missing"));const a=(0,e.hJ)(this.firestore,c.F.EVENTS,t,c.F.EVENT_SCHEDULES),d=(0,e.JU)(a,r.uid);return(0,o.D)((0,e.QT)(d)).pipe((0,_.w)(s=>s.exists()?(0,o.D)((0,e.r7)(d,r)):(0,o.D)((0,e.pl)(d,r))))}addEventSchedules(t,r){if(!t)return(0,p._)(()=>new Error("ID is missing"));const a=[r.start_date.toDate().getHours(),r.start_date.toDate().getMinutes()],d=[r.end_date.toDate().getHours(),r.end_date.toDate().getMinutes()],s=this.getDateList(r.start_date,r.end_date,r.days).map(u=>({is_active:!0,start_date:l.EK.fromMillis(u.setHours(a[0],a[1])),end_date:l.EK.fromMillis(u.setHours(d[0],d[1]))}));return(0,v.D)([this.addSchedules(t,s),this.updateEvent({uid:t,end_date:r.end_date})]).pipe((0,f.U)(()=>t))}getDateList(t,r,a){if(!t||!r)return[];const d=[];let s=t.toDate();for(;s.getTime()<=r.toMillis();)a.includes(s.getDay())&&d.push(new Date(s)),s.setDate(s.getDate()+1);return d}hasParameter(t,r){return null!==t[r]||void 0!==t[r]}}i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=E.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})},4633:(M,m,n)=>{n.d(m,{O:()=>E});const E={red:{primary:"#ad2121",secondary:"#FAE3E3"},blue:{primary:"#1e90ff",secondary:"#D1E8FF"},yellow:{primary:"#e3bc08",secondary:"#FDF1BA"}}},7941:(M,m,n)=>{n.d(m,{d:()=>c});var E=n(2560),e=n(745),l=n(9785);class c{constructor(){this.userApiService=(0,E.f3M)(l.Q)}transform(_){return _?(console.log(_),this.userApiService.getUser(_)):(0,e.of)(null)}}c.\u0275fac=function(_){return new(_||c)},c.\u0275pipe=E.Yjl({name:"user",type:c,pure:!0})},3432:(M,m,n)=>{n.d(m,{S:()=>D});var E=n(2560),e=n(8873),l=n(6413),c=n(3609),o=n(2673),_=n(635),f=n(9345),v=n(9785);class p{constructor(){this.firestore=(0,E.f3M)(e.gg),this.teacherCollection=(0,e.hJ)(this.firestore,f.F.TEACHER),this.userApiService=(0,E.f3M)(v.Q)}getTeachers(){const i=(0,e.IO)(this.teacherCollection,(0,e.ar)("is_active","==",!0));return(0,c.D)((0,e.PL)(i)).pipe((0,o.w)(t=>{const r=t.docs.map(s=>s.data()),a=r.reduce((s,u)=>({...s,[u.uid]:u}),{}),d=r.map(s=>s.uid);return this.userApiService.getUsersInList(d).pipe((0,_.U)(s=>s.map(u=>({uid:a[u.uid].uid,phone:u.phone,email:u.email,first_name:u.first_name,middle_name:u.middle_name,last_name:u.last_name,avatar_url:u.avatar_urls?u.avatar_urls[0]:"",start_date:a[u.uid].start_date,styles:a[u.uid].styles,level:a[u.uid].level}))))}))}getTeacher(i){const h=(0,e.JU)(this.teacherCollection,i);return(0,c.D)((0,e.QT)(h)).pipe((0,_.U)(t=>t.data()),(0,o.w)(t=>this.userApiService.getUser(t.uid).pipe((0,_.U)(r=>({uid:t.uid,phone:r.phone,email:r.email,first_name:r.first_name,middle_name:r.middle_name,last_name:r.last_name,avatar_url:r.avatar_urls[0],start_date:t.start_date,styles:t.styles,level:t.level})))))}addTeacher(i){const h=(0,e.JU)(this.teacherCollection,i.uid);return(0,c.D)((0,e.QT)(h)).pipe((0,o.w)(t=>(i.updated_on=l.EK.now(),i.start_date=l.EK.now(),t.exists()?(0,c.D)((0,e.r7)(h,i)):(i.created_on=l.EK.now(),(0,c.D)((0,e.pl)(h,i))))),(0,o.w)(()=>this.userApiService.updateUser({uid:i.uid,is_teacher:!0})))}removeTeacher(i){const h=(0,e.JU)(this.teacherCollection,i.uid);return i.updated_on=l.EK.now(),i.end_date=l.EK.now(),(0,c.D)((0,e.r7)(h,{uid:i.uid,is_active:!1,updated_on:i.updated_on,end_date:i.end_date})).pipe((0,o.w)(()=>this.userApiService.updateUser({uid:i.uid,is_teacher:!1})))}}p.\u0275fac=function(i){return new(i||p)},p.\u0275prov=E.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"});class D{constructor(){this.teacherApiService=(0,E.f3M)(p),this.userApiService=(0,E.f3M)(v.Q)}getList(){return this.teacherApiService.getTeachers()}getUsers(){return this.userApiService.getUsersNotTeachers()}addTeacher(i){return this.teacherApiService.addTeacher(i)}removeTeacher(i){return this.teacherApiService.removeTeacher(i)}}D.\u0275fac=function(i){return new(i||D)},D.\u0275prov=E.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"})}}]);
//# sourceMappingURL=common.1e26159b72cf9fcc.js.map