"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[592],{3223:(g,D,a)=>{a.d(D,{p:()=>s});var l=a(2560),e=a(8873),_=a(6413),o=a(9345),d=a(3609),E=a(2673),f=a(635),v=a(1640),p=a(5474),m=a(9525),T=a(745);class s{constructor(){this.firestore=(0,l.f3M)(e.gg),this.eventsCollection=(0,e.hJ)(this.firestore,o.F.EVENTS)}getFilteredEvents(){const t=(0,e.IO)(this.eventsCollection,(0,e.ar)("is_active","==",!0),(0,e.Xo)("start_date"));return(0,d.D)((0,e.PL)(t)).pipe((0,E.w)(r=>{const u=r.docs.map(i=>i.data()).map(i=>{const c=(0,e.hJ)(this.firestore,o.F.EVENTS,i.uid,o.F.EVENT_SCHEDULES),S=(0,e.IO)(c);return(0,d.D)((0,e.PL)(S)).pipe((0,f.U)(U=>U.docs.map(M=>M.data()).map(M=>({...i,start_date:M.start_date,end_date:M.end_date,is_active:M.is_active}))))});return(0,v.D)(u).pipe((0,f.U)(i=>i.flat()))}))}getEvents(){const t=(0,e.IO)(this.eventsCollection,(0,e.Xo)("created_on","desc"));return(0,d.D)((0,e.PL)(t)).pipe((0,f.U)(r=>r.docs.map(n=>n.data())))}addEvent(t){return t?this.hasParameter(t,"start_date")&&this.hasParameter(t,"end_date")&&this.hasParameter(t,"days")?(t.created_on=_.EK.now(),t.updated_on=_.EK.now(),t.is_active=!0,(0,d.D)((0,e.ET)(this.eventsCollection,t)).pipe((0,E.w)(r=>{const n=[t.start_date.toDate().getHours(),t.start_date.toDate().getMinutes()],u=[t.end_date.toDate().getHours(),t.end_date.toDate().getMinutes()],i=this.getDateList(t.start_date,t.end_date,t.days).map(c=>({is_active:!0,start_date:_.EK.fromMillis(c.setHours(n[0],n[1])),end_date:_.EK.fromMillis(c.setHours(u[0],u[1]))}));return(0,v.D)([this.addSchedules(r.id,i),this.updateEvent({uid:r.id})]).pipe((0,f.U)(()=>r.id))}))):(0,p._)(()=>new Error("Parameter is missing")):(0,p._)(()=>new Error("Event is missing"))}addSchedules(t,r){const n=(0,e.qs)(this.firestore),u=(0,e.hJ)(this.firestore,o.F.EVENTS,t,o.F.EVENT_SCHEDULES);return r.map(i=>{n.set((0,e.JU)(u),i)}),(0,d.D)(n.commit())}updateEvent(t){if(!t.uid)return(0,p._)(()=>new Error("ID is missing"));const r=(0,e.JU)(this.eventsCollection,t.uid);return(0,d.D)((0,e.QT)(r)).pipe((0,E.w)(n=>(t.updated_on=_.EK.now(),n.exists()?(0,d.D)((0,e.r7)(r,t)):(t.created_on=_.EK.now(),(0,d.D)((0,e.pl)(r,t))))))}removeEvent(t){const r=(0,e.JU)(this.eventsCollection,t.uid);return t.updated_on=_.EK.now(),(0,d.D)((0,e.r7)(r,{is_active:!1,updated_on:t.updated_on}))}getEvent(t){const r=(0,e.JU)(this.eventsCollection,t);return(0,d.D)((0,e.QT)(r)).pipe((0,m.z)(n=>n.exists()?(0,T.of)(n):(0,p._)(()=>new Error("Event not found"))),(0,f.U)(n=>n.data()))}getEventSchedules(t){const r=(0,e.hJ)(this.firestore,o.F.EVENTS,t,o.F.EVENT_SCHEDULES),n=(0,e.IO)(r,(0,e.Xo)("start_date"));return(0,d.D)((0,e.PL)(n)).pipe((0,f.U)(u=>u.docs.map(i=>({...i.data(),uid:i.id}))))}updateEventSchedule(t,r){if(!t||!r.uid)return(0,p._)(()=>new Error("ID is missing"));const n=(0,e.hJ)(this.firestore,o.F.EVENTS,t,o.F.EVENT_SCHEDULES),u=(0,e.JU)(n,r.uid);return(0,d.D)((0,e.QT)(u)).pipe((0,E.w)(i=>i.exists()?(0,d.D)((0,e.r7)(u,r)):(0,d.D)((0,e.pl)(u,r))))}addEventSchedules(t,r){if(!t)return(0,p._)(()=>new Error("ID is missing"));const n=[r.start_date.toDate().getHours(),r.start_date.toDate().getMinutes()],u=[r.end_date.toDate().getHours(),r.end_date.toDate().getMinutes()],i=this.getDateList(r.start_date,r.end_date,r.days).map(c=>({is_active:!0,start_date:_.EK.fromMillis(c.setHours(n[0],n[1])),end_date:_.EK.fromMillis(c.setHours(u[0],u[1]))}));return(0,v.D)([this.addSchedules(t,i),this.updateEvent({uid:t,end_date:r.end_date})]).pipe((0,f.U)(()=>t))}getDateList(t,r,n){if(!t||!r)return[];const u=[];let i=t.toDate();for(;i.getTime()<=r.toMillis();)n.includes(i.getDay())&&u.push(new Date(i)),i.setDate(i.getDate()+1);return u}hasParameter(t,r){return null!==t[r]||void 0!==t[r]}}s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=l.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})},4633:(g,D,a)=>{a.d(D,{O:()=>l});const l={red:{primary:"#ad2121",secondary:"#FAE3E3"},blue:{primary:"#1e90ff",secondary:"#D1E8FF"},yellow:{primary:"#e3bc08",secondary:"#FDF1BA"}}},7941:(g,D,a)=>{a.d(D,{d:()=>o});var l=a(2560),e=a(745),_=a(9785);class o{constructor(){this.userApiService=(0,l.f3M)(_.Q)}transform(E){return E?(console.log(E),this.userApiService.getUser(E)):(0,e.of)(null)}}o.\u0275fac=function(E){return new(E||o)},o.\u0275pipe=l.Yjl({name:"user",type:o,pure:!0})},3432:(g,D,a)=>{a.d(D,{S:()=>m});var l=a(2560),e=a(8873),_=a(6413),o=a(3609),d=a(2673),E=a(635),f=a(9345),v=a(9785);class p{constructor(){this.firestore=(0,l.f3M)(e.gg),this.teacherCollection=(0,e.hJ)(this.firestore,f.F.TEACHER),this.userApiService=(0,l.f3M)(v.Q)}getTeachers(){const s=(0,e.IO)(this.teacherCollection,(0,e.ar)("is_active","==",!0));return(0,o.D)((0,e.PL)(s)).pipe((0,d.w)(t=>{const r=t.docs.map(i=>i.data()),n=r.reduce((i,c)=>({...i,[c.uid]:c}),{}),u=r.map(i=>i.uid);return this.userApiService.getUsersInList(u).pipe((0,E.U)(i=>i.map(c=>({uid:n[c.uid].uid,phone:c.phone,email:c.email,first_name:c.first_name,middle_name:c.middle_name,last_name:c.last_name,avatar_url:c.avatar_urls?c.avatar_urls[0]:"",start_date:n[c.uid].start_date,styles:n[c.uid].styles,level:n[c.uid].level}))))}))}getTeacher(s){const h=(0,e.JU)(this.teacherCollection,s);return(0,o.D)((0,e.QT)(h)).pipe((0,E.U)(t=>t.data()),(0,d.w)(t=>this.userApiService.getUser(t.uid).pipe((0,E.U)(r=>({uid:t.uid,phone:r.phone,email:r.email,first_name:r.first_name,middle_name:r.middle_name,last_name:r.last_name,avatar_url:r.avatar_urls[0],start_date:t.start_date,styles:t.styles,level:t.level})))))}addTeacher(s){const h=(0,e.JU)(this.teacherCollection,s.uid);return(0,o.D)((0,e.QT)(h)).pipe((0,d.w)(t=>(s.updated_on=_.EK.now(),s.start_date=_.EK.now(),t.exists()?(0,o.D)((0,e.r7)(h,s)):(s.created_on=_.EK.now(),(0,o.D)((0,e.pl)(h,s))))),(0,d.w)(()=>this.userApiService.updateUser({uid:s.uid,is_teacher:!0})))}removeTeacher(s){const h=(0,e.JU)(this.teacherCollection,s.uid);return s.updated_on=_.EK.now(),s.end_date=_.EK.now(),(0,o.D)((0,e.r7)(h,{uid:s.uid,is_active:!1,updated_on:s.updated_on,end_date:s.end_date})).pipe((0,d.w)(()=>this.userApiService.updateUser({uid:s.uid,is_teacher:!1})))}}p.\u0275fac=function(s){return new(s||p)},p.\u0275prov=l.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"});class m{constructor(){this.teacherApiService=(0,l.f3M)(p),this.userApiService=(0,l.f3M)(v.Q)}getList(){return this.teacherApiService.getTeachers()}getUsers(){return this.userApiService.getUsersNotTeachers()}addTeacher(s){return this.teacherApiService.addTeacher(s)}removeTeacher(s){return this.teacherApiService.removeTeacher(s)}}m.\u0275fac=function(s){return new(s||m)},m.\u0275prov=l.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"})}}]);
//# sourceMappingURL=common.e479c1f8f2bd28fe.js.map