"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[181],{9181:($,f,l)=>{l.r(f),l.d(f,{AppCalendarModule:()=>_});var d=l(4666),e=l(2560),s=l(1242),C=l(9525),y=l(635),D=l(4633),x=l(4164),M=l(9785),T=l(3223);class p{constructor(){this.authService=(0,e.f3M)(x._o),this.eventApiService=(0,e.f3M)(T.p),this.userApiService=(0,e.f3M)(M.Q)}getEvents(){return this.authService.getToken().pipe((0,C.z)(n=>this.eventApiService.getFilteredEvents().pipe((0,y.U)(t=>(console.log("events",t),t.map(o=>this.convertEventToCalendar(o,n.getPayload().user_id)))))))}getUsersByIds(n){return this.userApiService.getUsersInList(n)}updateEnrolledParticipants(n){return this.authService.getToken().pipe((0,C.z)(t=>this.eventApiService.updateEnrolledParticipants({uid:n,enrolled_participants:t.getPayload().user_id})))}removeEnrolledParticipants(n){return this.authService.getToken().pipe((0,C.z)(t=>this.eventApiService.removeEnrolledParticipants({uid:n,enrolled_participants:t.getPayload().user_id})))}convertEventToCalendar(n,t){return{id:n.uid,start:new Date(n.start_date.toMillis()),end:n.end_date?new Date(n.end_date.toMillis()):void 0,title:n.title,color:D.O[n.colors],allDay:n.allDay,cssClass:n.cssClass,meta:{...n.meta,teacher_uids:n.teacher_uids,is_enrolled:!!n.enrolled_participants?.includes(t)}}}}p.\u0275fac=function(n){return new(n||p)},p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"});class u extends s.m${monthViewColumnHeader({date:n,locale:t}){return(0,d.p6)(n,"EEEE","ru")}dayViewHour({date:n,locale:t}){return(0,d.p6)(n,"HH:mm","ru")}weekViewHour({date:n,locale:t}){return this.dayViewHour({date:n,locale:t})}}u.\u0275fac=function(){let a;return function(t){return(a||(a=e.n5z(u)))(t||u)}}(),u.\u0275prov=e.Yz7({token:u,factory:u.\u0275fac});class v extends s.KZ{constructor(n){super(),this.locale=n}month(n){return`<b>${(0,d.p6)(n.start,"HH:mm",this.locale)}</b> ${n.title}`}week(n){return`<b>${(0,d.p6)(n.start,"HH:mm",this.locale)}</b> ${n.title}`}day(n){return`<b>${(0,d.p6)(n.start,"HH:mm",this.locale)}</b> ${n.title}`}}v.\u0275fac=function(n){return new(n||v)(e.LFG(e.soG))},v.\u0275prov=e.Yz7({token:v,factory:v.\u0275fac});var r=l(1008),Z=l(3470),O=l(5845),b=l(7091);class w{constructor(){this.locale="ru",this.viewChange=new e.vpe,this.viewDateChange=new e.vpe,this.CalendarView=s.wr}}w.\u0275fac=function(n){return new(n||w)},w.\u0275cmp=e.Xpm({type:w,selectors:[["app-calendar-header"]],inputs:{view:"view",viewDate:"viewDate",locale:"locale"},outputs:{viewChange:"viewChange",viewDateChange:"viewDateChange"},decls:14,vars:9,consts:[[1,"header"],[1,"col-md-4"],[1,"btn-group"],["mwlCalendarPreviousView","",1,"btn","btn-primary",3,"view","viewDate","viewDateChange"],["icon","arrow-ios-back-outline"],["mwlCalendarToday","",1,"btn","btn-outline-secondary",3,"viewDate","viewDateChange"],["mwlCalendarNextView","",1,"btn","btn-primary",3,"view","viewDate","viewDateChange"],["icon","arrow-ios-forward-outline"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e.NdJ("viewDateChange",function(i){return t.viewDate=i})("viewDateChange",function(){return t.viewDateChange.next(t.viewDate)}),e._UZ(4,"nb-icon",4),e.qZA(),e.TgZ(5,"div",5),e.NdJ("viewDateChange",function(i){return t.viewDate=i})("viewDateChange",function(){return t.viewDateChange.next(t.viewDate)}),e._uU(6," \u0421\u0435\u0433\u043e\u0434\u043d\u044f "),e.qZA(),e.TgZ(7,"div",6),e.NdJ("viewDateChange",function(i){return t.viewDate=i})("viewDateChange",function(){return t.viewDateChange.next(t.viewDate)}),e._UZ(8,"nb-icon",7),e.qZA()()(),e.TgZ(9,"div",1)(10,"h3"),e._uU(11),e.ALo(12,"calendarDate"),e.qZA()(),e._UZ(13,"div",1),e.qZA()),2&n&&(e.xp6(3),e.Q6J("view",t.view)("viewDate",t.viewDate),e.xp6(2),e.Q6J("viewDate",t.viewDate),e.xp6(2),e.Q6J("view",t.view)("viewDate",t.viewDate),e.xp6(4),e.Oqu(e.xi3(12,6,t.viewDate,t.view+"ViewTitle")))},dependencies:[s.YX,s.MG,s.nA,r.fMN,s.vk],styles:[".header[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;margin-bottom:.625rem}.btn-group[_ngcontent-%COMP%]{display:flex;align-items:center}@media screen and (max-width: 768px){.btn-group[_ngcontent-%COMP%]{justify-content:center;flex:1 100%;margin-bottom:.625rem}}.btn[_ngcontent-%COMP%]{-webkit-appearance:none;appearance:none;text-align:center;display:inline-flex;align-items:center;justify-content:center;white-space:nowrap;vertical-align:middle;-webkit-user-select:none;user-select:none;cursor:var(--button-cursor);padding:var(--button-filled-medium-padding);font-family:var(--button-text-font-family);font-weight:var(--button-text-font-weight);font-size:var(--button-medium-text-font-size);line-height:var(--button-medium-text-line-height);border-radius:var(--button-rectangle-border-radius)}.btn-outline[_ngcontent-%COMP%]{border-style:var(--button-outline-border-style);border-width:var(--button-outline-border-width);text-transform:var(--button-outline-text-transform);background-color:var(--button-outline-primary-background-color);border-color:var(--button-outline-primary-border-color);color:var(--button-outline-primary-text-color)}.btn-primary[_ngcontent-%COMP%]{border-style:var(--button-filled-border-style);border-width:var(--button-filled-border-width);text-transform:var(--button-filled-text-transform);background-color:var(--button-filled-primary-background-color);border-color:var(--button-filled-primary-border-color);color:var(--button-filled-primary-text-color)}@media screen and (max-width: 768px){.btn-primary[_ngcontent-%COMP%]{--button-filled-medium-padding: 4px}}.col-md-4[_ngcontent-%COMP%]{flex:0 33%;text-align:center}@media screen and (max-width: 902px){.col-md-4[_ngcontent-%COMP%]{flex:1 100%}}"]});var A=l(7941);function P(a,n){if(1&a&&(e.TgZ(0,"nb-option",7),e._uU(1),e.qZA()),2&a){const t=n.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}const h=function(){return[]};function H(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"mwl-calendar-month-view",8),e.NdJ("dayClicked",function(i){e.CHM(t);const c=e.oxw();return e.KtG(c.dayClicked(i.day))})("eventClicked",function(i){e.CHM(t);const c=e.oxw(),m=e.MAs(12);return e.KtG(c.openDialog(m,i.event))}),e.ALo(1,"async"),e.qZA()}if(2&a){const t=e.oxw();e.Q6J("viewDate",t.viewDate)("activeDayIsOpen",t.activeDayIsOpen)("events",e.lcZ(1,3,t.events$)||e.DdM(5,h))}}function k(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"mwl-calendar-week-view",9),e.NdJ("eventClicked",function(i){e.CHM(t);const c=e.oxw(),m=e.MAs(12);return e.KtG(c.openDialog(m,i.event))}),e.ALo(1,"async"),e.qZA()}if(2&a){const t=e.oxw();e.Q6J("dayStartHour",9)("dayEndHour",23)("viewDate",t.viewDate)("events",e.lcZ(1,4,t.events$)||e.DdM(6,h))}}function E(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"mwl-calendar-day-view",9),e.NdJ("eventClicked",function(i){e.CHM(t);const c=e.oxw(),m=e.MAs(12);return e.KtG(c.openDialog(m,i.event))}),e.ALo(1,"async"),e.qZA()}if(2&a){const t=e.oxw();e.Q6J("dayStartHour",9)("dayEndHour",23)("viewDate",t.viewDate)("events",e.lcZ(1,4,t.events$)||e.DdM(6,h))}}function F(a,n){if(1&a&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&a){const t=n.ngIf;e.xp6(1),e.AsE("",null==t?null:t.first_name," ",null==t?null:t.last_name," ")}}function J(a,n){if(1&a&&(e.TgZ(0,"div"),e.YNc(1,F,2,2,"span",12),e.ALo(2,"async"),e.ALo(3,"user"),e.qZA()),2&a){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,e.lcZ(3,3,t)))}}function S(a,n){if(1&a&&(e.TgZ(0,"nb-list-item")(1,"div",10),e._uU(2,"\u041f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u0438:"),e.qZA(),e.TgZ(3,"div",11),e.YNc(4,J,4,5,"div",15),e.qZA()()),2&a){const t=e.oxw().$implicit;e.xp6(4),e.Q6J("ngForOf",t.meta.teacher_uids)}}function N(a,n){if(1&a&&(e.TgZ(0,"nb-list-item")(1,"div",10),e._uU(2,"\u041e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u0435:"),e.qZA(),e.TgZ(3,"div",11),e._uU(4),e.ALo(5,"date"),e.qZA()()),2&a){const t=e.oxw().$implicit;e.xp6(4),e.Oqu(e.xi3(5,1,t.end,"dd.MM.yyyy HH:mm"))}}function I(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,c=e.oxw();return e.KtG(c.entry(i.id))}),e._uU(1,"\u0417\u0430\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f"),e.qZA()}if(2&a){const t=e.oxw(2);e.Q6J("disabled",t.loading)}}function Q(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,c=e.oxw();return e.KtG(c.removeEntry(i.id))}),e._uU(1,"\u0423\u0431\u0440\u0430\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c"),e.qZA()}if(2&a){const t=e.oxw(2);e.Q6J("disabled",t.loading)}}function U(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"nb-card")(1,"nb-card-header"),e._uU(2,"\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f"),e.qZA(),e.TgZ(3,"nb-card-body")(4,"nb-list")(5,"nb-list-item")(6,"div",10),e._uU(7,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435:"),e.qZA(),e.TgZ(8,"div",11),e._uU(9),e.qZA()(),e.YNc(10,S,5,1,"nb-list-item",12),e.TgZ(11,"nb-list-item")(12,"div",10),e._uU(13,"\u041d\u0430\u0447\u0430\u043b\u043e:"),e.qZA(),e.TgZ(14,"div",11),e._uU(15),e.ALo(16,"date"),e.qZA()(),e.YNc(17,N,6,4,"nb-list-item",12),e.qZA()(),e.TgZ(18,"nb-card-footer"),e.YNc(19,I,2,1,"button",13),e.YNc(20,Q,2,1,"button",13),e.TgZ(21,"button",14),e.NdJ("click",function(){const c=e.CHM(t).$implicit,m=e.oxw();return e.KtG(m.navigate(c.id))}),e._uU(22,"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"),e.qZA()()()}if(2&a){const t=n.$implicit;e.xp6(9),e.Oqu(t.title),e.xp6(1),e.Q6J("ngIf",t.meta.teacher_uids),e.xp6(5),e.Oqu(e.xi3(16,6,t.start,"dd.MM.yyyy HH:mm")),e.xp6(2),e.Q6J("ngIf",t.end),e.xp6(2),e.Q6J("ngIf",!t.meta.is_enrolled),e.xp6(1),e.Q6J("ngIf",t.meta.is_enrolled)}}class g{constructor(){this.calendarService=(0,e.f3M)(p),this.dialogService=(0,e.f3M)(r.Gln),this.toastr=(0,e.f3M)(r.quB),this.router=(0,e.f3M)(b.F0),this.loading=!1,this.activeDayIsOpen=!0,this.CalendarView=s.wr,this.calendarViewOptions=Object.values(s.wr),this.viewDate=new Date,this.view=s.wr.Month}calculateRows(){window.innerWidth<768&&(this.view=s.wr.Day)}ngOnInit(){this.calculateRows(),this.getData()}getData(){this.events$=this.calendarService.getEvents()}selectView(n){this.view=n}openDialog(n,t){this.ref=this.dialogService.open(n,{context:t})}dayClicked({date:n,events:t}){(0,Z.Z)(n,this.viewDate)&&((0,O.Z)(this.viewDate,n)&&!0===this.activeDayIsOpen||0===t.length?this.activeDayIsOpen=!1:this.activeDayIsOpen=!0,this.viewDate=n)}entry(n){this.loading=!0,this.calendarService.updateEnrolledParticipants(n).subscribe({complete:()=>{this.toastr.show("\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0447\u0442\u043e \u0437\u0430\u043f\u0438\u0441\u0430\u043b\u0438\u0441\u044c","\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b",{status:"success"}),this.loading=!1,this.ref.close(),this.getData()},error:t=>{this.toastr.show(t?.message,"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430",{status:"danger"}),console.log("error",t),this.loading=!1}})}removeEntry(n){this.loading=!0,this.calendarService.removeEnrolledParticipants(n).subscribe({complete:()=>{this.toastr.show("\u0412\u044b \u0443\u0431\u0440\u0430\u043b\u0438 \u0437\u0430\u043f\u0438\u0441\u044c","\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b",{status:"success"}),this.loading=!1,this.ref.close(),this.getData()},error:t=>{this.toastr.show(t?.message,"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430",{status:"danger"}),console.log("error",t),this.loading=!1}})}navigate(n){this.ref.close(),this.router.navigate(["event",n])}}g.\u0275fac=function(n){return new(n||g)},g.\u0275cmp=e.Xpm({type:g,selectors:[["app-calendar"]],hostBindings:function(n,t){1&n&&e.NdJ("resize",function(i){return t.calculateRows(i)},!1,e.Jf7)},features:[e._Bn([{provide:s.m$,useClass:u},{provide:s.KZ,useClass:v}])],decls:13,vars:8,consts:[["name","view",1,"desktop",3,"selected","selectedChange"],[3,"value",4,"ngFor","ngForOf"],[3,"ngSwitch"],[3,"view","viewDate","viewChange","viewDateChange"],["precision","minutes",3,"viewDate","activeDayIsOpen","events","dayClicked","eventClicked",4,"ngSwitchCase"],["precision","minutes",3,"dayStartHour","dayEndHour","viewDate","events","eventClicked",4,"ngSwitchCase"],["showInfo",""],[3,"value"],["precision","minutes",3,"viewDate","activeDayIsOpen","events","dayClicked","eventClicked"],["precision","minutes",3,"dayStartHour","dayEndHour","viewDate","events","eventClicked"],[1,"title"],[1,"value"],[4,"ngIf"],["nbButton","","status","primary","outline","",3,"disabled","click",4,"ngIf"],["nbButton","","status","primary",1,"card-button",3,"click"],[4,"ngFor","ngForOf"],["nbButton","","status","primary","outline","",3,"disabled","click"]],template:function(n,t){1&n&&(e.TgZ(0,"nb-layout")(1,"nb-layout-column")(2,"nb-card")(3,"nb-card-header")(4,"nb-select",0),e.NdJ("selectedChange",function(i){return t.selectView(i)}),e.YNc(5,P,2,2,"nb-option",1),e.qZA()(),e.TgZ(6,"nb-card-body",2)(7,"app-calendar-header",3),e.NdJ("viewChange",function(i){return t.view=i})("viewDateChange",function(i){return t.viewDate=i}),e.qZA(),e.YNc(8,H,2,6,"mwl-calendar-month-view",4),e.YNc(9,k,2,7,"mwl-calendar-week-view",5),e.YNc(10,E,2,7,"mwl-calendar-day-view",5),e.qZA()(),e.YNc(11,U,23,9,"ng-template",null,6,e.W1O),e.qZA()()),2&n&&(e.xp6(4),e.Q6J("selected",t.view),e.xp6(1),e.Q6J("ngForOf",t.calendarViewOptions),e.xp6(1),e.Q6J("ngSwitch",t.view),e.xp6(1),e.Q6J("view",t.view)("viewDate",t.viewDate),e.xp6(1),e.Q6J("ngSwitchCase","month"),e.xp6(1),e.Q6J("ngSwitchCase","week"),e.xp6(1),e.Q6J("ngSwitchCase","day"))},dependencies:[d.sg,d.O5,d.RF,d.n9,s.GH,s.TK,s.Se,r.Aqw,r.dP_,r.Asz,r.yKW,r.XWE,r.ndF,r.DPz,r.rs,r.q51,r.zP_,r.qBV,w,d.Ov,d.uU,A.d],styles:["[_nghost-%COMP%]   nb-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}[_nghost-%COMP%]     .cal-week-view .cal-time-events .cal-day-column{margin-right:10px}[_nghost-%COMP%]     .cal-week-view .cal-hour{width:calc(100% + 10px)}[_nghost-%COMP%]     mwl-calendar-month-view .cal-event-action{margin:0 10px;color:var(--button-filled-primary-text-color)}[_nghost-%COMP%]     mwl-calendar-week-view .cal-event-action, [_nghost-%COMP%]     mwl-calendar-day-view .cal-event-action{margin-right:4px;color:var(--button-outline-primary-text-color)}nb-list-item[_ngcontent-%COMP%]{--list-item-padding: .625rem 0;--list-item-divider-width: 0;display:flex;justify-content:space-between;align-items:flex-start}nb-list-item[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:200px}nb-list-item[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-child{text-align:right}nb-card-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.card-button[_ngcontent-%COMP%]{margin-left:auto}@media screen and (max-width: 768px){nb-card-header[_ngcontent-%COMP%]{flex-direction:column}nb-card-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:.5rem}.desktop[_ngcontent-%COMP%]{display:none}nb-list-item[_ngcontent-%COMP%]{flex-direction:column}nb-list-item[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{text-align:center}nb-list-item[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-child{text-align:center}}"]});var q=l(4466);class _{}_.\u0275fac=function(n){return new(n||_)},_.\u0275mod=e.oAB({type:_}),_.\u0275inj=e.cJS({imports:[d.ez,s._8,r.BW0,r.zyh,r.T2N,r.IIj,r.KdK,r.COg,r.KdK,q.m,b.Bz.forChild([{path:"",component:g,data:{title:"\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435"}}])]})}}]);
//# sourceMappingURL=181.acc12cad73a0f632.js.map