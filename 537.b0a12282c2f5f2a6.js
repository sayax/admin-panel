"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[537],{537:(D,F,o)=>{o.r(F),o.d(F,{TeacherListModule:()=>_});var A=o(4666),e=o(2560),c=o(8873),v=o(6413),m=o(3609),T=o(2673),Z=o(635),E=o(9345),x=o(9785);class h{constructor(){this.firestore=(0,e.f3M)(c.gg),this.teacherCollection=(0,c.hJ)(this.firestore,E.F.TEACHER),this.userApiService=(0,e.f3M)(x.Q)}getTeachers(){const t=(0,c.IO)(this.teacherCollection,(0,c.ar)("is_active","==",!0));return(0,m.D)((0,c.PL)(t)).pipe((0,T.w)(i=>{const r=i.docs.map(p=>p.data()),s=r.reduce((p,l)=>({...p,[l.uid]:l}),{}),y=r.map(p=>p.uid);return this.userApiService.getUsersInList(y).pipe((0,Z.U)(p=>p.map(l=>({uid:s[l.uid].uid,phone:l.phone,email:l.email,first_name:l.first_name,middle_name:l.middle_name,last_name:l.last_name,avatar_url:l.avatar_urls?l.avatar_urls[0]:"",start_date:s[l.uid].start_date,styles:s[l.uid].styles,level:s[l.uid].level}))))}))}getTeacher(t){const n=(0,c.JU)(this.teacherCollection,t);return(0,m.D)((0,c.QT)(n)).pipe((0,Z.U)(i=>i.data()),(0,T.w)(i=>this.userApiService.getUser(i.uid).pipe((0,Z.U)(r=>({uid:i.uid,phone:r.phone,email:r.email,first_name:r.first_name,middle_name:r.middle_name,last_name:r.last_name,avatar_url:r.avatar_urls[0],start_date:i.start_date,styles:i.styles,level:i.level})))))}addTeacher(t){const n=(0,c.JU)(this.teacherCollection,t.uid);return(0,m.D)((0,c.QT)(n)).pipe((0,T.w)(i=>(t.updated_on=v.EK.now(),t.start_date=v.EK.now(),i.exists()?(0,m.D)((0,c.r7)(n,t)):(t.created_on=v.EK.now(),(0,m.D)((0,c.pl)(n,t))))),(0,T.w)(()=>this.userApiService.updateUser({uid:t.uid,is_teacher:!0})))}removeTeacher(t){const n=(0,c.JU)(this.teacherCollection,t.uid);return t.updated_on=v.EK.now(),t.end_date=v.EK.now(),(0,m.D)((0,c.r7)(n,{uid:t.uid,is_active:!1,updated_on:t.updated_on,end_date:t.end_date})).pipe((0,T.w)(()=>this.userApiService.updateUser({uid:t.uid,is_teacher:!1})))}}h.\u0275fac=function(t){return new(t||h)},h.\u0275prov=e.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"});class f{constructor(){this.teacherApiService=(0,e.f3M)(h),this.userApiService=(0,e.f3M)(x.Q)}getList(){return this.teacherApiService.getTeachers()}getUsers(){return this.userApiService.getUsersNotTeachers()}addTeacher(t){return this.teacherApiService.addTeacher(t)}removeTeacher(t){return this.teacherApiService.removeTeacher(t)}}f.\u0275fac=function(t){return new(t||f)},f.\u0275prov=e.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"});var b,u,g,a=o(5403),d=o(2508);(u=b||(b={})).kizomba="kizomba",u.salsa="salsa",u.bachata="bachata",function(u){u.beginner="beginner",u.intermediate="intermediate",u.advanced="advanced",u.pro="pro"}(g||(g={}));var B=o(8217);function J(u,t){if(1&u){const n=e.EpF();e.TgZ(0,"nb-list-item"),e._UZ(1,"nb-user",7),e.ALo(2,"async"),e.ALo(3,"mediaUrl"),e.TgZ(4,"button",8),e.NdJ("click",function(){const s=e.CHM(n).$implicit,y=e.oxw(3);return e.KtG(y.removeTeacher(s))}),e._UZ(5,"nb-icon",9),e.qZA()()}if(2&u){const n=t.$implicit,i=e.oxw(3);e.xp6(1),e.Q6J("picture",e.lcZ(2,4,e.lcZ(3,6,n.avatar_url))||"")("name",n.first_name+" "+n.last_name)("title",n.level+" \u043f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c"),e.xp6(3),e.Q6J("disabled",i.loading)}}function U(u,t){if(1&u&&(e.TgZ(0,"nb-list"),e.YNc(1,J,6,8,"nb-list-item",6),e.qZA()),2&u){const n=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",n)}}function L(u,t){if(1&u&&(e.ynx(0),e.YNc(1,U,2,1,"nb-list",5),e.BQk()),2&u){const n=t.ngIf;e.oxw();const i=e.MAs(8);e.xp6(1),e.Q6J("ngIf",n.length)("ngIfElse",i)}}function M(u,t){1&u&&(e.TgZ(0,"p"),e._uU(1,"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u043f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u0435\u0439"),e.qZA())}function S(u,t){if(1&u&&(e.TgZ(0,"nb-option",21),e._uU(1),e.qZA()),2&u){const n=t.$implicit;e.Q6J("value",n.uid),e.xp6(1),e.AsE("",n.first_name," ",n.last_name,"")}}function O(u,t){if(1&u&&(e.TgZ(0,"nb-option",21),e._uU(1),e.qZA()),2&u){const n=t.$implicit;e.Q6J("value",n.value),e.xp6(1),e.Oqu(n.title)}}function Q(u,t){if(1&u&&(e.TgZ(0,"nb-option",21),e._uU(1),e.qZA()),2&u){const n=t.$implicit;e.Q6J("value",n.value),e.xp6(1),e.Oqu(n.title)}}function k(u,t){if(1&u){const n=e.EpF();e.TgZ(0,"nb-card")(1,"nb-card-header"),e._uU(2,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044f"),e.qZA(),e.TgZ(3,"nb-card-body")(4,"form",10)(5,"div",11)(6,"label",12),e._uU(7,"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c"),e.qZA(),e.TgZ(8,"nb-select",13),e.YNc(9,S,2,3,"nb-option",14),e.ALo(10,"async"),e.qZA()(),e.TgZ(11,"div",11)(12,"label",15),e._uU(13,"\u0421\u0442\u0438\u043b\u0438"),e.qZA(),e.TgZ(14,"nb-select",16),e.YNc(15,O,2,2,"nb-option",14),e.qZA()(),e.TgZ(16,"div",11)(17,"label",17),e._uU(18,"\u0423\u0440\u043e\u0432\u0435\u043d\u044c"),e.qZA(),e.TgZ(19,"nb-select",18),e.YNc(20,Q,2,2,"nb-option",14),e.qZA()()()(),e.TgZ(21,"nb-card-footer")(22,"button",19),e.NdJ("click",function(){const s=e.CHM(n).dialogRef;return e.KtG(s.close())}),e._uU(23,"\u041e\u0442\u043c\u0435\u043d\u0430"),e.qZA(),e.TgZ(24,"button",20),e.NdJ("click",function(){e.CHM(n);const r=e.oxw();return e.KtG(r.addTeacher(r.form))}),e._uU(25,"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),e.qZA()()()}if(2&u){const n=e.oxw();let i,r,s;e.xp6(4),e.Q6J("formGroup",n.form),e.xp6(4),e.Q6J("status",null!=(i=n.form.get("uid"))&&i.touched?null!=(i=n.form.get("uid"))&&i.invalid?"danger":"success":"basic"),e.xp6(1),e.Q6J("ngForOf",e.lcZ(10,8,n.users$)),e.xp6(5),e.Q6J("status",null!=(r=n.form.get("styles"))&&r.touched?null!=(r=n.form.get("styles"))&&r.invalid?"danger":"success":"basic"),e.xp6(1),e.Q6J("ngForOf",n.styles),e.xp6(4),e.Q6J("status",null!=(s=n.form.get("level"))&&s.touched?null!=(s=n.form.get("level"))&&s.invalid?"danger":"success":"basic"),e.xp6(1),e.Q6J("ngForOf",n.levels),e.xp6(4),e.Q6J("disabled",n.loading)}}class C{constructor(){this.teacherService=(0,e.f3M)(f),this.dialogService=(0,e.f3M)(a.Gln),this.formBuilder=(0,e.f3M)(d.qu),this.toastr=(0,e.f3M)(a.quB),this.cdr=(0,e.f3M)(e.sBO),this.loading=!1,this.styles=[{value:b.kizomba,title:"\u041a\u0438\u0437\u043e\u043c\u0431\u0430"},{value:b.salsa,title:"\u0421\u0430\u043b\u044c\u0441\u0430"},{value:b.bachata,title:"\u0411\u0430\u0447\u0430\u0442\u0430"}],this.levels=[{value:g.beginner,title:"\u041d\u0430\u0447\u0438\u043d\u0430\u044e\u0449\u0438\u0439"},{value:g.intermediate,title:"\u0421\u0440\u0435\u0434\u043d\u0438\u0439"},{value:g.advanced,title:"\u0412\u044b\u0441\u043e\u043a\u0438\u0439"},{value:g.pro,title:"\u041f\u0440\u043e\u0444\u0438"}],this.form=this.formBuilder.group({uid:[null,d.kI.required],is_active:[!0],styles:[null],level:["",d.kI.required]})}ngOnInit(){this.getData()}getData(){this.list$=this.teacherService.getList(),this.users$=this.teacherService.getUsers()}openDialog(t){this.ref=this.dialogService.open(t)}addTeacher(t){this.teacherService.addTeacher(t.value).subscribe({complete:()=>{this.toastr.show("\u041f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d","\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b",{status:"success"}),this.loading=!1,this.ref.close(),this.cdr.markForCheck(),this.getData()},error:n=>{this.toastr.show(n?.message,"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430",{status:"error"}),console.log("error",n),this.loading=!1,this.cdr.markForCheck()}})}removeTeacher(t){this.teacherService.removeTeacher({uid:t.uid}).subscribe({complete:()=>{this.toastr.show("\u041f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c \u0443\u0434\u0430\u043b\u0435\u043d","\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b",{status:"success"}),this.loading=!1,this.cdr.markForCheck(),this.getData()},error:n=>{this.toastr.show(n?.message,"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430",{status:"error"}),console.log("error",n),this.loading=!1,this.cdr.markForCheck()}})}}C.\u0275fac=function(t){return new(t||C)},C.\u0275cmp=e.Xpm({type:C,selectors:[["app-teacher-list"]],decls:11,vars:3,consts:[["size","large"],["nbButton","","status","primary","type","button",3,"click"],[4,"ngIf"],["noTeachers",""],["dialog",""],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],[3,"picture","name","title"],["nbButton","","type","button","nbTooltip","\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044f","nbTooltipStatus","primary",1,"teacher-delete-button",3,"disabled","click"],["icon","trash-outline"],[3,"formGroup"],[1,"form-group"],["for","uid"],["placeholder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f","name","uid","formControlName","uid",3,"status"],[3,"value",4,"ngFor","ngForOf"],["for","styles"],["multiple","","placeholder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0438\u043b\u0438","name","styles","formControlName","styles",3,"status"],["for","level"],["placeholder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0443\u0440\u043e\u0432\u0435\u043d\u044c","name","level","formControlName","level",3,"status"],["nbButton","",3,"click"],["nbButton","","status","primary",3,"disabled","click"],[3,"value"]],template:function(t,n){if(1&t){const i=e.EpF();e.TgZ(0,"nb-card",0)(1,"nb-card-header")(2,"button",1),e.NdJ("click",function(){e.CHM(i);const s=e.MAs(10);return e.KtG(n.openDialog(s))}),e._uU(3,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044f"),e.qZA()(),e.TgZ(4,"nb-card-body"),e.YNc(5,L,2,2,"ng-container",2),e.ALo(6,"async"),e.YNc(7,M,2,0,"ng-template",null,3,e.W1O),e.qZA()(),e.YNc(9,k,26,10,"ng-template",null,4,e.W1O)}2&t&&(e.xp6(5),e.Q6J("ngIf",e.lcZ(6,1,n.list$)))},dependencies:[A.sg,A.O5,a.zP_,a.qBV,a.Asz,a.yKW,a.XWE,a.ndF,a.k0$,a.DPz,a.rs,a.q51,a.fMN,a.jNv,d._Y,d.JJ,d.JL,d.sg,d.u,A.Ov,B.B],styles:["[_nghost-%COMP%]   nb-user[_ngcontent-%COMP%]     .user-title{text-transform:capitalize}.form-group[_ngcontent-%COMP%]{margin-bottom:.625rem}.teacher-delete-button[_ngcontent-%COMP%]{--button-filled-basic-background-color: transparent;--button-filled-basic-hover-background-color: transparent;--button-filled-basic-focus-background-color: transparent;margin-left:auto}nb-card-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between}"],changeDetection:0});var N=o(9510),I=o(4466);class _{}_.\u0275fac=function(t){return new(t||_)},_.\u0275mod=e.oAB({type:_}),_.\u0275inj=e.cJS({imports:[A.ez,a.COg,a.zyh,a.AE1,a.T2N,a.IIj,a.nKr,a.KdK,a.rgH,d.UX,a.j7H.forChild(),I.m,N.Bz.forChild([{path:"",component:C,data:{title:"\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u0435\u0439"}}])]})}}]);
//# sourceMappingURL=537.b0a12282c2f5f2a6.js.map