"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[765],{4765:(k,v,r)=>{r.r(v),r.d(v,{ProfileModule:()=>m});var g=r(4666),e=r(2560),o=r(2508),b=r(4164),Z=r(2673),C=r(9337),A=r(8915),_=r(635),U=r(5474),x=r(3954),T=r(9785);class s{constructor(){this.nbAuthService=(0,e.f3M)(b._o),this.mediaService=(0,e.f3M)(x.y),this.userApiService=(0,e.f3M)(T.Q)}uploadFile(u){return u?this.nbAuthService.getToken().pipe((0,Z.w)(t=>{const i=`profile/${t.getPayload().user_id}`;return this.mediaService.uploadFile(u.item(0),i)}),(0,_.U)(t=>t.ref.fullPath)):(0,U._)(()=>new Error("no image"))}getfile(u){return this.mediaService.getMedia(u)}updateUser(u){return this.userApiService.updateUser(u)}}s.\u0275fac=function(u){return new(u||s)},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"});var a=r(1008),y=r(8217);function F(l,u){if(1&l){const t=e.EpF();e.TgZ(0,"form",1),e.NdJ("submit",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.updateUser(n.form))}),e.TgZ(1,"div",2),e._UZ(2,"nb-user",3),e.ALo(3,"async"),e.ALo(4,"mediaUrl"),e.TgZ(5,"button",4)(6,"input",5),e.NdJ("change",function(n){e.CHM(t);const d=e.oxw();return e.KtG(d.uploadFile(n))}),e.qZA(),e._uU(7," \u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0444\u043e\u0442\u043e "),e.qZA()(),e.TgZ(8,"div",6)(9,"div",7)(10,"label",8),e._uU(11," \u0418\u043c\u044f "),e.qZA(),e._UZ(12,"input",9),e.qZA(),e.TgZ(13,"div",7)(14,"label",10),e._uU(15," \u0424\u0430\u043c\u0438\u043b\u0438\u044f "),e.qZA(),e._UZ(16,"input",11),e.qZA(),e.TgZ(17,"div",7)(18,"label",12),e._uU(19," \u041e\u0442\u0447\u0435\u0441\u0442\u0432\u043e "),e.qZA(),e._UZ(20,"input",13),e.qZA(),e.TgZ(21,"div",7)(22,"label",14),e._uU(23," \u0422\u0435\u043b\u0435\u0444\u043e\u043d "),e.qZA(),e._UZ(24,"input",15),e.qZA(),e.TgZ(25,"div",7)(26,"label",16),e._uU(27," E-mail "),e.qZA(),e._UZ(28,"input",17),e.qZA(),e.TgZ(29,"div",7)(30,"label",18),e._uU(31," \u041f\u043e\u043b "),e.qZA(),e.TgZ(32,"nb-select",19)(33,"nb-option",20),e._uU(34,"\u041c"),e.qZA(),e.TgZ(35,"nb-option",21),e._uU(36,"\u0416"),e.qZA()()(),e.TgZ(37,"div",7)(38,"label",22),e._uU(39," \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 "),e.qZA(),e._UZ(40,"textarea",23),e.qZA(),e.TgZ(41,"div",7)(42,"label",24),e._uU(43," \u0410\u0434\u0440\u0435\u0441 "),e.qZA(),e._UZ(44,"textarea",25),e.qZA(),e.TgZ(45,"nb-checkbox",26),e._uU(46,"\u041f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c"),e.qZA(),e.TgZ(47,"nb-checkbox",27),e._uU(48,"\u0423\u0447\u0435\u043d\u0438\u043a"),e.qZA(),e.TgZ(49,"nb-checkbox",28),e._uU(50,"\u0417\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d"),e.qZA(),e.TgZ(51,"div")(52,"button",29),e._uU(53,"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),e.qZA()()()()}if(2&l){const t=e.oxw();let i,n,d,f,p,h;e.Q6J("formGroup",t.form),e.xp6(2),e.Q6J("picture",t.form.value.avatar_urls&&e.lcZ(3,9,e.lcZ(4,11,t.form.value.avatar_urls[0]))||""),e.xp6(10),e.Q6J("status",null!=(i=t.form.get("first_name"))&&i.touched?null!=(i=t.form.get("first_name"))&&i.invalid?"danger":"success":"basic"),e.xp6(4),e.Q6J("status",null!=(n=t.form.get("last_name"))&&n.touched?null!=(n=t.form.get("last_name"))&&n.invalid?"danger":"success":"basic"),e.xp6(8),e.Q6J("status",null!=(d=t.form.get("phone"))&&d.touched?null!=(d=t.form.get("phone"))&&d.invalid?"danger":"success":"basic"),e.xp6(4),e.Q6J("status",null!=(f=t.form.get("email"))&&f.touched?null!=(f=t.form.get("email"))&&f.invalid?"danger":"success":"basic"),e.xp6(4),e.Q6J("status",null!=(p=t.form.get("gender"))&&p.touched?null!=(p=t.form.get("gender"))&&p.invalid?"danger":"success":"basic"),e.xp6(12),e.Q6J("status",null!=(h=t.form.get("address"))&&h.touched?null!=(h=t.form.get("address"))&&h.invalid?"danger":"success":"basic"),e.xp6(8),e.Q6J("disabled",t.loading)}}const M=function(l){return{user:l}};class c{constructor(){this.nbAuthService=(0,e.f3M)(b._o),this.authService=(0,e.f3M)(A.e),this.profileService=(0,e.f3M)(s),this.toastr=(0,e.f3M)(a.quB),this.formBuilder=(0,e.f3M)(o.qu),this.cdr=(0,e.f3M)(e.sBO),this.loading=!1,this.form=this.formBuilder.group({uid:["",o.kI.required],phone:["",o.kI.required],email:["",[o.kI.required,o.kI.email]],first_name:["",o.kI.required],middle_name:[""],last_name:["",o.kI.required],gender:["",o.kI.required],description:[""],address:["",o.kI.required],is_teacher:[{value:!1,disabled:!0}],is_student:[{value:!1,disabled:!0}],is_blocked:[{value:!1,disabled:!0}],avatar_urls:[[]]}),this.user$=this.nbAuthService.getToken().pipe((0,Z.w)(u=>(this.form.patchValue({uid:u.getPayload().user_id}),this.authService.getUser(u.getPayload().user_id))),(0,C.b)(u=>{console.log(u),this.form.patchValue(u),console.log(this.form.getRawValue())}))}uploadFile(u){this.profileService.uploadFile(u.target.files).subscribe(t=>{this.form.patchValue({avatar_urls:[t]}),this.cdr.markForCheck()})}updateUser(u){if(u.invalid)return this.toastr.show("\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043f\u043e\u043b\u044f","\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",{status:"warning"}),this.form.markAsDirty(),this.form.markAllAsTouched(),this.cdr.markForCheck(),void console.log(this.form);this.loading=!0,this.cdr.markForCheck(),this.profileService.updateUser(u.getRawValue()).subscribe({complete:()=>{this.toastr.show("\u041f\u0440\u043e\u0444\u0438\u043b\u044c \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d","\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b",{status:"success"}),this.loading=!1,this.cdr.markForCheck()},error:t=>{this.toastr.show(t?.message,"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430",{status:"error"}),console.log("error",t),this.loading=!1,this.cdr.markForCheck()}})}}c.\u0275fac=function(u){return new(u||c)},c.\u0275cmp=e.Xpm({type:c,selectors:[["app-profile"]],decls:3,vars:5,consts:[["class","profile-form",3,"formGroup","submit",4,"ngIf"],[1,"profile-form",3,"formGroup","submit"],[1,"profile-image"],["showName","false",3,"picture"],["nbButton","","status","primary","outline","","type","button",1,"profile-uplaod-image-button"],["type","file",3,"change"],[1,"profile-block"],[1,"form-group"],["for","first_name"],["name","first_name","nbInput","","placeholder","\u0418\u043c\u044f","formControlName","first_name",3,"status"],["for","last_name"],["name","last_name","nbInput","","placeholder","\u0424\u0430\u043c\u0438\u043b\u0438\u044f","formControlName","last_name",3,"status"],["for","middle_name"],["name","middle_name","nbInput","","placeholder","\u041e\u0442\u0447\u0435\u0441\u0442\u0432\u043e","formControlName","middle_name"],["for","phone"],["nbInput","","placeholder","\u0422\u0435\u043b\u0435\u0444\u043e\u043d","name","phone","formControlName","phone",3,"status"],["for","email"],["nbInput","","placeholder","E-mail","name","email","formControlName","email",3,"status"],["for","gender"],["placeholder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u043e\u043b","name","gender","formControlName","gender",3,"status"],["value","male"],["value","female"],["for","description"],["nbInput","","placeholder","\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435","name","description","formControlName","description"],["for","address"],["nbInput","","placeholder","\u0410\u0434\u0440\u0435\u0441","name","address","formControlName","address",3,"status"],["formControlName","is_teacher"],["formControlName","is_student"],["formControlName","is_blocked"],["nbButton","","status","primary","type","submit",3,"disabled"]],template:function(u,t){1&u&&(e.TgZ(0,"nb-card"),e.YNc(1,F,54,13,"form",0),e.ALo(2,"async"),e.qZA()),2&u&&(e.xp6(1),e.Q6J("ngIf",e.VKq(3,M,e.lcZ(2,1,t.user$))))},dependencies:[g.O5,a.Asz,o._Y,o.Fj,o.JJ,o.JL,o.sg,o.u,a.h8i,a.DPz,a.NTf,a.rs,a.q51,a.k0$,g.Ov,y.B],styles:['.profile-form[_ngcontent-%COMP%]{display:grid;justify-content:center;grid-template-areas:"image block";grid-template-columns:200px auto;gap:1rem;padding:1rem}.profile-image[_ngcontent-%COMP%]{display:flex;flex-direction:column;grid-area:image}.profile-image[_ngcontent-%COMP%]   nb-user[_ngcontent-%COMP%]{--user-medium-width: 200px;--user-medium-height: 200px;--user-medium-initials-text-font-size: 54px;margin-bottom:.625rem}.profile-uplaod-image-button[_ngcontent-%COMP%]{position:relative}.profile-uplaod-image-button[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.profile-block[_ngcontent-%COMP%]{display:flex;flex-direction:column;grid-area:block;row-gap:.625rem}'],changeDetection:0});var P=r(7091),E=r(4466);class m{}m.\u0275fac=function(u){return new(u||m)},m.\u0275mod=e.oAB({type:m}),m.\u0275inj=e.cJS({imports:[g.ez,a.zyh,o.UX,a.nKr,a.T2N,a.MfT,a.IIj,a.AE1,E.m,P.Bz.forChild([{path:"",component:c,data:{title:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"}}])]})}}]);
//# sourceMappingURL=765.a6fd4f13c3ed9dbd.js.map